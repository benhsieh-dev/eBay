@if (loading) {
  <div class="loading">Loading product...</div>
}

@if (error) {
  <div class="error">{{ error }}</div>
}

@if (product && !loading) {
  <div class="product-container">
    <div class="image-section">
      @if (product.images && product.images.length > 0) {
        <img
          class="main-image"
          [src]="getImageUrl(product.images[selectedImageIndex])"
          alt="Product Image"
        />

        <div class="thumbnail-row">
          @for (image of product.images; let i = $index; track image) {
            <img
              class="thumbnail-image"
              [src]="getImageUrl(image)"
              alt="Thumbnail Image"
              (click)="selectImage(i)"
              [class.active]="i === selectedImageIndex"
            />
          }
        </div>
      } @else {
        <div class="no-image">
          <p>No images available</p>
          @if (isOwner && product.status === 'ACTIVE') {
            <button (click)="openImageUpload()" class="btn-secondary btn-small add-images-btn">
              ðŸ“· Add Images
            </button>
          }
        </div>
      }
    </div>

          <!-- DETAILS -->
          <div class="details-section">

            <h2>{{ product.title }}</h2>
            <p class="description">{{ product.description }}</p>

            <p><strong>Current Price:</strong> ${{ product.currentPrice }}</p>
            <p><strong>Buy It Now:</strong> ${{ product.buyNowPrice }}</p>

            <!-- BID FORM -->
            <div class="bid-box">
              <input
                type="number"
                [(ngModel)]="bidAmount"
                placeholder="Enter bid amount"
              />
              <button (click)="placeBid()">Place Bid</button>
            </div>

            <button class="buy-now-btn" (click)="buyItNow()">
              Buy It Now
            </button>

            <!-- BID HISTORY -->
            <div class="bid-history">
              <h3>Bid History</h3>
              <div *ngFor="let bid of bidHistory">
                <p>{{ bid.amount }} â€” {{ bid.timestamp | date:'short' }}</p>
              </div>
            </div>

          </div>

          </div>
}

<!-- Image Upload Modal -->
@if (showImageUpload) {
  <div class="modal-overlay" (click)="closeImageUpload()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Add Images to Your Listing</h3>
        <button (click)="closeImageUpload()" class="close-button">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="upload-section">
          <input type="file" 
                 #fileInput 
                 (change)="onFileSelected($event)" 
                 multiple 
                 accept="image/*"
                 class="file-input" />
          
          <div class="upload-area" 
               (click)="fileInput.click()"
               [class.dragover]="isDragOver"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDrop($event)">
            <div class="upload-icon">ðŸ“·</div>
            <p>Click to select images or drag and drop</p>
            <p class="upload-hint">You can upload multiple images (JPG, PNG, GIF)</p>
          </div>
        </div>
        
        @if (selectedFiles.length > 0) {
          <div class="file-preview">
            <h4>Selected Images ({{ selectedFiles.length }})</h4>
            <div class="preview-grid">
              @for (file of selectedFiles; let i = $index; track file) {
                <div class="preview-item">
                  <img [src]="getFilePreview(file)" [alt]="file.name" />
                  <button (click)="removeFile(i)" class="remove-file-btn">&times;</button>
                  <p class="file-name">{{ file.name }}</p>
                </div>
              }
            </div>
          </div>
        }
        
        @if (uploadError) {
          <div class="error-message">
            {{ uploadError }}
          </div>
        }
      </div>
      
      <div class="modal-footer">
        <button (click)="closeImageUpload()" class="btn-secondary">Cancel</button>
        <button (click)="uploadImages()" 
                [disabled]="selectedFiles.length === 0 || isUploading"
                class="btn-primary">
          {{ isUploading ? 'Uploading...' : 'Upload Images' }}
        </button>
      </div>
    </div>
  </div>
}

